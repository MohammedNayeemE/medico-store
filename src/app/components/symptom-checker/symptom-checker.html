<div class="chat-container">
  <div class="chat-header">
    <div class="header-info">
      <h1>ðŸ’Š Health Assistant Chat</h1>
      <p>Describe your symptoms and get medicine suggestions</p>
    </div>
    <button (click)="clearChat()" class="clear-btn" title="Clear chat">
      <i class="fa-solid fa-trash"></i>
    </button>
  </div>

  <div class="chat-messages" #chatContainer>
    <div *ngFor="let message of messages()" class="message-wrapper" [class.user-message]="message.type === 'user'" [class.bot-message]="message.type === 'bot'">
      
      <!-- Bot Message -->
      <div *ngIf="message.type === 'bot'" class="message bot">
        <div class="message-avatar">
          <i class="fa-solid fa-robot"></i>
        </div>
        <div class="message-content">
          <div class="message-text">{{ message.text }}</div>
          
          <!-- Medicine Cards -->
          <div *ngIf="message.medicines && message.medicines.length > 0" class="medicines-grid">
            <div *ngFor="let medicine of message.medicines" class="medicine-card">
              <img [src]="medicine.img" [alt]="medicine.name" class="medicine-img" />
              <div class="medicine-info">
                <span class="medicine-type">{{ medicine.type }}</span>
                <h4 class="medicine-name">{{ medicine.name }}</h4>
                <p class="medicine-desc">{{ medicine.description }}</p>
                <span *ngIf="medicine.dosage" class="medicine-dosage">{{ medicine.dosage }}</span>
                <div class="medicine-footer">
                  <span class="medicine-price">{{ medicine.priceStr }}</span>
                  <button 
                    (click)="addToCart(medicine)"
                    [disabled]="isInCart(medicine.name)"
                    [class.in-cart]="isInCart(medicine.name)"
                    class="add-cart-btn">
                    <i class="fa-solid" [ngClass]="isInCart(medicine.name) ? 'fa-check' : 'fa-cart-plus'"></i>
                    {{ isInCart(medicine.name) ? 'Added' : 'Add' }}
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <span class="message-time">{{ message.timestamp | date:'short' }}</span>
        </div>
      </div>

      <!-- User Message -->
      <div *ngIf="message.type === 'user'" class="message user">
        <div class="message-content">
          <div class="message-text">{{ message.text }}</div>
          <span class="message-time">{{ message.timestamp | date:'short' }}</span>
        </div>
        <div class="message-avatar">
          <i class="fa-solid fa-user"></i>
        </div>
      </div>
    </div>

    <!-- Typing Indicator -->
    <div *ngIf="isTyping()" class="message-wrapper bot-message">
      <div class="message bot">
        <div class="message-avatar">
          <i class="fa-solid fa-robot"></i>
        </div>
        <div class="message-content">
          <div class="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="chat-input-container">
    <input 
      type="text" 
      [ngModel]="userInput()"
      (ngModelChange)="userInput.set($event)"
      (keyup.enter)="sendMessage()"
      placeholder="Type your symptoms here... (e.g., 'I have a headache')"
      class="chat-input"
      [disabled]="isTyping()"
    />
    <button 
      (click)="sendMessage()" 
      class="send-btn"
      [disabled]="!userInput().trim() || isTyping()">
      <i class="fa-solid fa-paper-plane"></i>
    </button>
  </div>
</div>
